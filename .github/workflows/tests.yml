# SPDX-FileCopyrightText: 2026 Juan Medina
# SPDX-License-Identifier: MIT

name: Tests

on:
    push:
        branches: [ "**" ]
    pull_request:
        branches: [ "**" ]

jobs:
    test:
        name: ${{ matrix.name }}
        runs-on: ${{ matrix.os }}

        strategy:
            fail-fast: false
            matrix:
                include:
                    -   name: Linux GCC
                        os: ubuntu-latest
                        cc: gcc
                        cxx: g++
                        cmake_flags: -G Ninja

                    -   name: macOS Apple Clang
                        os: macos-latest
                        cc: clang
                        cxx: clang++
                        cmake_flags: -G Ninja

                    -   name: Windows MSVC
                        os: windows-latest
                        cmake_flags: ""

        steps:
            -   name: Checkout
                uses: actions/checkout@v4
                with:
                    submodules: recursive

            -   name: Install dependencies (Linux)
                if: runner.os == 'Linux'
                run: |
                    sudo apt-get update
                    sudo apt-get install -y cmake ninja-build

            -   name: Install dependencies (macOS)
                if: runner.os == 'macOS'
                run: brew install cmake ninja

            -   name: Configure
                env:
                    CC: ${{ matrix.cc }}
                    CXX: ${{ matrix.cxx }}
                run: cmake -B build -DCMAKE_BUILD_TYPE=Debug -DLGE_BUILD_TESTS=ON ${{ matrix.cmake_flags }}

            -   name: Build
                run: cmake --build build --target lge_tests

            -   name: Run tests
                run: ctest --test-dir build --output-on-failure